{% extends 'base.html.twig' %}

{% block stylesheets %}
  {{ parent() }}
  <link rel="stylesheet" href="{{ asset('css/profile.css') }}">
{% endblock %}

{% block title %}Mon historique{% endblock %}

{% block body %}
<div class="profile-main-container">
  <div class="profile-card-container">

    <!-- Onglets -->
    <div class="profile-buttons-container tab-buttons-right">
      <a href="{{ path('account.profile') }}" class="tab-button {% if app.request.attributes.get('_route') == 'account.profile' %}active{% endif %}">Profil</a>
      <a href="{{ path('account.favorites') }}" class="tab-button {% if app.request.attributes.get('_route') == 'account.favorites' %}active{% endif %}">Favoris</a>
      <a href="{{ path('account.history') }}" class="tab-button {% if app.request.attributes.get('_route') == 'account.history' %}active{% endif %}">Historique</a>
      <a href="{{ path('account.security') }}" class="tab-button {% if app.request.attributes.get('_route') == 'account.security' %}active{% endif %}">Sécurité</a>
    </div>

    <!-- Contenu principal -->
    <div class="profile-mycard-container card-container-large">
      <h2>Historique</h2>

      <div class="profile-history-section">
        <!-- Topics créés -->
        <h3>Mes sujets</h3>
        {% if topics|length > 0 %}
          <ul class="history-list">
            {% for topic in topics %}
              <li>
                <a href="{{ path('topic.show', { id: topic.id }) }}">{{ topic.title }}</a>
                <span class="history-date">créé le {{ topic.createdAt|date('d/m/Y') }}</span>
              </li>
            {% endfor %}
          </ul>
          <div class="profile-pagination">
            {{ knp_pagination_render(topics, null, {'pageParameterName': 'topicPage'}) }}
          </div>
        {% else %}
          <p class="history-empty">Tu n'as pas encore créé de sujet.</p>
        {% endif %}

        <!-- Posts créés -->
        <h3>Mes réponses</h3>
        {% if posts|length > 0 %}
          <ul class="history-list">
            {% for post in posts %}
              <li>
                <a href="{{ path('topic.show', { id: post.topic.id }) }}#post-{{ post.id }}">
                  {{ post.content|slice(0, 100) ~ '...' }}
                </a>
                <span class="history-date">posté le {{ post.createdAt|date('d/m/Y') }}</span>
              </li>
            {% endfor %}
          </ul>
          <div class="profile-pagination">
            {{ knp_pagination_render(posts, null, {'pageParameterName': 'postPage'}) }}
          </div>
        {% else %}
          <p class="history-empty">Tu n'as pas encore posté de réponse.</p>
        {% endif %}
      </div>
    </div>

  </div>
</div>
{% endblock %}